---
title: Configuring CORS with Apollo Server
description: Control resource access to your server
---

## CORS Basics

[Cross-Origin Resource Sharing](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) (CORS) is an HTTP-header based protocol that allows a server to dictate which origins, besides its self, have access to its resources. In simpler terms, the server can specify if the the code in the browser can read the contents of the server's response.

## Background

To better understand what CORS why it is needed, it's necessary to have some background context. Let's start by covering what an _origin_ in this context is: a server's Origin is it's domain, protocol, and por.

<!-- Cover the same-origin policy -->
The [same-source origin policy](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy) (SOP) is a security mechanism that restricts server requests to only those on the same origin. So a server can request and respond with resources for URLS with an identical origin (domain, protocol, and port) to their own.

<!-- What CORS does and how it protects server -->
<!--  How does CORS affect SOP? Can it just skip it over or does it instead ADD to it? -->
Cross-Origin Resource Sharing, is how a server can safely _share_ resources across different origins.  CORS enables servers to have a layer of protection by letting them define HTTP headers, which specify the external client scripts that can access their resources.

A web application makes a cross-origin HTTP request when it requests a resource that has a different origin (domain, protocol, and port) than its own origin.





## Configuring CORS with Apollo Server

<!--  Cover `*` -->
CORS uses [a number of HTTP response headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#the_http_response_headers) in both the request and response as part of it's protocol, but the most  wellknown is the [`Access-Control-Allow-Origin`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin) response header.  `Access-Control-Allow-Origin` is returned by the server and indicates which clients are allowed to access its resources.

> If you want to pass headers (cookies) you cannot use the default `*` option. You must provide a specified domain learn more below! Can pass in [config options](https://github.com/expressjs/cors#configuration-options) directly to specify which domains have access.

By default, the [batteries-included `apollo-server` package `cors` constructor option](../api/apollo-server/#cors) allows all requests `*` allow requesting code from any origin to access the resource.

> If you are working with another integration of Apollo Server, [check out the CORS configuration for your specific package](../api/apollo-server/#cors-1).

This works great in development, allowing you to delay configuring CORS until your application is ready for production. To disallow other origins from making request to your server you should set a more restrictive cors policy to only allow server access to the clients who need it. This will keep bad actors from accesssing your sever (this matters with/without credentials).

 You can provide the following [config options](https://github.com/expressjs/cors#configuration-options) to the `cors` configuration option passed into Apollo Server.

The batteries-included Apollo Server uses the [Express `cors` middleware package](https://www.npmjs.com/package/cors) under the hood to enable you to easily configure your server's CORS configuration.


<!--  Examples of setting custom cors policy for batteries included AS3 -->
<!--  Do I need to cover Access-Control-Allow-Credentials? -->
You can set cors in your middleware specific implementation

```js
server.applyMiddleware({
  app,
  path: '/graphql',
  cors: {
    origin: "https://localhost:3000"
  }
});
```


You can also turn CORS off for your server, allowing all traffic which can lead to security implications.

Setting more granular cors options : use your own middleware

```js
var corsOptions = {
  origin: process.env.FRONTEND_URL,
  credentials: true
};
// set up Cors for express middleware NOT in the apollo-server section
app.use(cors(corsOptions));

server.applyMiddleware({
  app,
  path: '/',
  cors: corsOptions, // disables the apollo-server-express cors to allow the cors middleware use
})

app.listen({ port: 4000 }, () =>
  console.log(`ðŸš€ Server ready at http://localhost:4000${server.graphqlPath}`)
);
```

## Authentication and CORS
If you want your API to be cookie authenticated then youâ€™ll need to improve things. HTTP cookies not sent by default over CORSâ€” to enable them you must set your `cors` middleware configuration to allow credentials:

Allows [`Access-Control-Allow-Credentials`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials):

```js
app.use(cors({
  origin: yourSpecificOrigin
  credentials: true,
}));
```



<!-- Cookie example with CORS -->
[Add in Client Docs](https://www.apollographql.com/docs/react/networking/basic-http-networking) example of cookies


- What is CORS?
  - How is it used?
- How do CORS + GraphQL + Apollo Server work?
  - Examples of setting up different options?
  - Defaults of â€˜*â€™
  - The different `cors` options and what they mean in this context?
    - How restrict access  to your API? (authenticated / not)
- Best practices around using CORS?
  - How should I list specific origins I'd like to allow?
  - How to use credentials with CORS?
  - Which headers/request methods to allow?
  - How send cookies?

  Questions
  - Samesit=non cookies?
    Cookies sent in all contexts  first-party and cross-origin requests

- What are the best practices we advice here? Only allow Get requests?




## Resources

https://github.com/apollographql/apollo-server/issues/5076
We need to generally document whatâ€™s important to think about with CORS and AS.  Notably, that our default of â€˜*â€™ might be not good enough for two reasons: first, that it doesnâ€™t let anyone send cookies so if you want your API to be cookie authenticated then youâ€™ll need to improve things; and second that maybe you donâ€™t want arbitrary origins able to send requests to your API (even without being able to use the userâ€™s credentials).

We also need to fix the issue from that thread.  That issue is a CSRF issue which is a step past CORS â€” CSRF kinda lets you do nasty things that youâ€™d think your CORS policy should block. Fixing that issue is going to involve adding a new Apollo Server option (off by default in AS3, on by default in AS4) that basically lets you make requests fail if they donâ€™t contain certain special headers; this mostly will affect GET requests. Happy to work with you on crafting the docs for that.  I think itâ€™s OK if we add the overall CORS advice docs first and then update them with the new anti-CSRF advice second.
